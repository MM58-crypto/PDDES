{% extends "base.html" %}

{% load bootstrap5 %}

{% load static %}

<head>
   <!-- <link rel="stylesheet" href="{% static 'kb_style.css' %}"> -->
</head>

{% block content %}

{% load crispy_forms_tags %} 
<br>
<h2><center>Knowledge Base Interface</center></h2>
<div class="container py-5">
   
    <form action="" method="POST" class="form2">
        {% csrf_token %}
        <br>
        <h3>Disorders</h3>
        <select id="disorder-select" name="disorder_name">
            {% for disorder in disorders %}
                <option value="{{ disorder.pk }}">{{ disorder.disorder_name }}</option>
            {% endfor %}
        </select>
        {{ diagnosis_form |crispy }}
       
        <br>

       
        <br>
        
        <!--
        <h4>Symptoms</h4>
        {{ symptoms_form|crispy }}
        <br> -->
        <button class="btn btn-info" type="submit">Save</button>
    </br>
    </form>
    <br>
    <!--
    <form action="" method="POST" class="form3">
        {% csrf_token %}
        <h3>System rules </h3>
        {{ system_rules|crispy }}
        <br>
        <button class="btn btn-primary" type="submit">Save</button>
        
    </br>
    </form> -->

</div>

<style>
   
    .container {
    max-width: 800px;
    margin: 0 auto;
}

form {
    margin-bottom: 30px;
}

h3 {
    font-size: 24px;
    margin-bottom: 20px;
    color: white;
}

h4 {
    font-size: 20px;
    margin-bottom: 10px;
}

button[type="submit"] {
    margin-top: 10px;
}

.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
}

.btn-primary:hover {
    background-color: #0069d9;
    border-color: #0062cc;
}

</style>

<!-- Using javascript/ajax to fetch data from database when user selects item from drop down menu-->
<script>
    var select = document.getElementById('disorder-select');
    select.addEventListener('change', function() {
        var disorderId = this.value;
        var url = '/get_disorder_info/?disorder_id=' + disorderId;
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var data = JSON.parse(xhr.responseText);
                document.getElementById('id_disorder_desc').value = data.disorder_desc;
                document.getElementById('id_disorder_keywords').value = data.disorder_keywords;
                document.getElementById('id_recommendation').value = data.recommendation;
            }
        };
        xhr.open('GET', url);
        xhr.send();
    });
</script>



    
{% endblock %}